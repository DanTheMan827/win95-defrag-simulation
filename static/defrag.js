// Generated by CoffeeScript 1.3.3
(function() {
  var genHDD, randInt;

  randInt = function(low, high) {
    return Math.round(Math.random() * (high - 1) + low);
  };

  genHDD = function(numCluster) {
    var i, rnd, run, val, _i, _results;
    _results = [];
    for (i = _i = 0; 0 <= numCluster ? _i <= numCluster : _i >= numCluster; i = 0 <= numCluster ? ++_i : --_i) {
      rnd = randInt(1, 600);
      switch (rnd) {
        case 1:
          run = randInt(2, 10);
          val = 1;
          break;
        case 2:
          run = randInt(2, 10);
          val = 2;
          break;
        case 4 || 40 || 44:
          run = randInt(20, 200);
          val = 4;
          break;
        case 5:
          run = randInt(1, 100);
          val = 5;
          break;
        case 6:
          run = randInt(5, 20);
          val = 6;
      }
      if (run > 0) {
        run--;
        _results.push(val);
      } else {
        _results.push(0);
      }
    }
    return _results;
  };

  $(function() {
    var canvas, clusterH, clusterW, ctx, drawHDD, resizeCanvas;
    canvas = document.getElementById('cluster-canvas');
    ctx = canvas.getContext('2d');
    clusterW = 9;
    clusterH = 11;
    $(window).resize(function() {
      return resizeCanvas();
    });
    resizeCanvas = function() {
      var columnSize, hdd, height, numCluster, rowSize, width;
      if (window.drawer) {
        clearInterval(window.drawer);
      }
      width = $('#viewer').width();
      height = $('#viewer').height();
      canvas.width = width;
      canvas.height = height;
      rowSize = Math.floor(width / clusterW);
      columnSize = Math.floor(height / clusterH);
      numCluster = Math.floor(rowSize * columnSize);
      hdd = genHDD(numCluster);
      return drawHDD(hdd, rowSize, columnSize, width, height);
    };
    drawHDD = function(hdd, rowSize, columnSize, width, height) {
      var clusterSprite;
      clusterSprite = new Image();
      clusterSprite.src = 'imgs/cluster_sprites.png';
      return clusterSprite.onload = function() {
        var animate, cluster, drawCluster, i, readCluster, writeCluster, _i, _len;
        drawCluster = function(cluster, index) {
          var xOffset, yOffset;
          xOffset = (index % rowSize) * clusterW;
          yOffset = Math.floor(index / rowSize) * clusterH;
          return ctx.drawImage(clusterSprite, clusterW * cluster, 0, clusterW, clusterH, xOffset, yOffset, clusterW, clusterH);
        };
        for (i = _i = 0, _len = hdd.length; _i < _len; i = ++_i) {
          cluster = hdd[i];
          drawCluster(cluster, i);
        }
        readCluster = function() {};
        writeCluster = function(cluster, index) {
          drawCluster(8, index);
          return setTimeout(function() {
            return drawCluster(3, index);
          }, 100);
        };
        animate = function(hdd) {
          var index;
          if (window.drawer) {
            clearInterval(window.drawer);
          }
          index = 0;
          return window.drawer = setInterval(function() {
            return setTimeout(function() {
              switch (hdd[index]) {
                case 0:
                  writeCluster(3, index);
              }
              return index++;
            }, randInt(500, 5000));
          }, 200);
        };
        return animate(hdd);
      };
    };
    return resizeCanvas();
  });

}).call(this);
