// Generated by CoffeeScript 1.3.3
(function() {
  var genHDD, randInt;

  randInt = function(low, high) {
    return Math.round(Math.random() * (high - 1) + low);
  };

  genHDD = function(numCluster) {
    var badRun, i, rnd, run, val, _i, _results;
    badRun = 0;
    _results = [];
    for (i = _i = 0; 0 <= numCluster ? _i <= numCluster : _i >= numCluster; i = 0 <= numCluster ? ++_i : --_i) {
      rnd = randInt(1, 600);
      switch (rnd) {
        case 1:
          run = randInt(2, 10);
          val = 1;
          break;
        case 2:
          run = randInt(2, 10);
          val = 2;
          break;
        case 4 || 40 || 44:
          run = randInt(20, 200);
          val = 4;
          break;
        case 5:
          run = randInt(1, 100);
          val = 5;
          break;
        case 6:
          run = randInt(5, 20);
          val = 6;
      }
      if (run > 0) {
        run--;
        _results.push(val);
      } else {
        _results.push(0);
      }
    }
    return _results;
  };

  $(function() {
    var canvas, clusterH, clusterW, ctx, drawHDD, resizeCanvas;
    canvas = document.getElementById('cluster-canvas');
    ctx = canvas.getContext('2d');
    clusterW = 9;
    clusterH = 11;
    $(window).resize(function() {
      return resizeCanvas();
    });
    resizeCanvas = function() {
      var columnSize, hdd, height, numCluster, rowSize, width;
      if (window.drawer) {
        clearInterval(window.drawer);
      }
      width = $('#viewer').width();
      height = $('#viewer').height();
      canvas.width = width;
      canvas.height = height;
      rowSize = Math.floor(width / clusterW);
      columnSize = Math.floor(height / clusterH);
      numCluster = Math.floor(rowSize * columnSize);
      hdd = genHDD(numCluster);
      return drawHDD(hdd, rowSize, columnSize, width, height);
    };
    drawHDD = function(hdd, rowSize, columnSize, width, height) {
      var clusterSprite;
      clusterSprite = new Image();
      clusterSprite.src = 'imgs/cluster_sprites.png';
      return clusterSprite.onload = function() {
        var cluster, clusterX, clusterY, drawCluster, i, srcX, srcY, _i, _len, _results;
        drawCluster = function(cluster, index) {
          var xOffset, yOffset;
          xOffset = (index % rowSize) * clusterW;
          yOffset = Math.floor(index / rowSize) * clusterH;
          return ctx.drawImage(clusterSprite, srcX + clusterW * cluster, srcY, clusterW, clusterH, xOffset, yOffset, clusterW, clusterH);
        };
        srcX = 0;
        srcY = 0;
        clusterX = -5;
        clusterY = 0;
        _results = [];
        for (i = _i = 0, _len = hdd.length; _i < _len; i = ++_i) {
          cluster = hdd[i];
          _results.push(drawCluster(cluster, i));
        }
        return _results;
        /*
              intervalCluster = ->
                if window.drawer then clearInterval window.drawer
        
                window.drawer = setInterval ->
                  width = $('#viewer').width()
                  height = $('#viewer').height()
                  i++
                  if i * (clusterW + 1) > (width - clusterW*2)
                    ctx.drawImage clusterSprite, srcX+clusterW*4, srcY, clusterW, clusterH, clusterX+8, clusterY, clusterW, clusterH
                    i = 0
                    clusterX = -5
                    clusterY += 10
        
                  if clusterY > (height/2)
                    resizeCanvas()
                    clearInterval window.drawer
        
                  ctx.drawImage clusterSprite, srcX+clusterW*3, srcY, clusterW, clusterH, clusterX+=8, clusterY, clusterW, clusterH
                  ctx.drawImage clusterSprite, srcX+clusterW*8, srcY, clusterW, clusterH, clusterX+8, clusterY, clusterW, clusterH
                , 100
        */

      };
    };
    return resizeCanvas();
  });

}).call(this);
